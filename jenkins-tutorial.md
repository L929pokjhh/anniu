# Jenkinsé›†æˆå¾®ä¿¡å°ç¨‹åºæŒ‰é’®æµ‹è¯•æ•™ç¨‹

## ğŸ“‹ æ¦‚è¿°

æœ¬æ•™ç¨‹å°†æŒ‡å¯¼ä½ å¦‚ä½•åœ¨Jenkins CI/CDç¯å¢ƒä¸­é›†æˆå¾®ä¿¡å°ç¨‹åºæŒ‰é’®åŠŸèƒ½æµ‹è¯•ï¼Œå®ç°è‡ªåŠ¨åŒ–æµ‹è¯•å’ŒæŠ¥å‘Šç”Ÿæˆã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

- âœ… **è‡ªåŠ¨åŒ–æµ‹è¯•**: æŒ‰é’®åŠŸèƒ½å…¨è¦†ç›–æµ‹è¯•
- âœ… **å¤šç§æŠ¥å‘Šæ ¼å¼**: JUnit XMLã€HTMLã€JSON
- âœ… **æ„å»ºçŠ¶æ€é›†æˆ**: æµ‹è¯•å¤±è´¥è‡ªåŠ¨æ ‡è®°æ„å»º
- âœ… **å¯è§†åŒ–æŠ¥å‘Š**: Jenkinså†…ç½®HTMLæŠ¥å‘ŠæŸ¥çœ‹å™¨
- âœ… **é”™è¯¯è¿½è¸ª**: è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª
- âœ… **æ€§èƒ½ç»Ÿè®¡**: æµ‹è¯•æ‰§è¡Œæ—¶é—´å’Œé€šè¿‡ç‡ç»Ÿè®¡

## ğŸ“ æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶
- **`jenkins-test.js`** - Jenkinsç¯å¢ƒä¸“ç”¨æµ‹è¯•è„šæœ¬
- **`Jenkinsfile`** - Jenkinsæµæ°´çº¿å®šä¹‰æ–‡ä»¶
- **`jenkins-tutorial.md`** - æœ¬æ•™ç¨‹æ–‡æ¡£

### é…ç½®æ–‡ä»¶
- **`package.json`** (å¯é€‰) - Node.jsä¾èµ–ç®¡ç†
- **`.eslintrc.js`** (å¯é€‰) - ä»£ç è´¨é‡æ£€æŸ¥é…ç½®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‡†å¤‡Jenkinsç¯å¢ƒ

#### å®‰è£…å¿…è¦æ’ä»¶
åœ¨Jenkinsä¸­å®‰è£…ä»¥ä¸‹æ’ä»¶ï¼š

1. **Node.js Plugin** - Node.jsç¯å¢ƒæ”¯æŒ
2. **HTML Publisher Plugin** - HTMLæŠ¥å‘Šå‘å¸ƒ
3. **JUnit Plugin** - JUnitæŠ¥å‘Šé›†æˆ
4. **Pipeline Plugin** - æµæ°´çº¿æ”¯æŒ

å®‰è£…æ–¹æ³•ï¼š
```
Jenkinsç®¡ç† > æ’ä»¶ç®¡ç† > å¯é€‰æ’ä»¶ > æœç´¢å¹¶å®‰è£…ä¸Šè¿°æ’ä»¶
```

#### é…ç½®Node.js
1. è¿›å…¥ `Jenkinsç®¡ç† > å…¨å±€å·¥å…·é…ç½®`
2. æ‰¾åˆ° `Node.js` éƒ¨åˆ†
3. ç‚¹å‡» `æ–°å¢ Node.js`
4. é…ç½®å¦‚ä¸‹ï¼š
   - **åç§°**: `Node.js 16.x`
   - **ç‰ˆæœ¬**: é€‰æ‹© `16.x` æˆ–æ›´é«˜ç‰ˆæœ¬
   - **è‡ªåŠ¨å®‰è£…**: å‹¾é€‰

### 2. é¡¹ç›®é…ç½®

#### åˆ›å»ºæ–°çš„Jenkinsé¡¹ç›®
1. ç™»å½•Jenkins
2. ç‚¹å‡» `æ–°å»ºItem`
3. è¾“å…¥é¡¹ç›®åç§°ï¼ˆå¦‚ï¼š`weapp-button-test`ï¼‰
4. é€‰æ‹© `Pipeline` ç±»å‹
5. ç‚¹å‡» `ç¡®å®š`

#### é…ç½®æµæ°´çº¿
1. åœ¨é¡¹ç›®é…ç½®é¡µé¢ï¼Œæ‰¾åˆ° `æµæ°´çº¿` éƒ¨åˆ†
2. é€‰æ‹© `Pipeline script from SCM`
3. **SCM**: é€‰æ‹© `Git`
4. **Repository URL**: è¾“å…¥ä½ çš„Gitä»“åº“åœ°å€
5. **Credentials**: é€‰æ‹©Gitå‡­æ®ï¼ˆå¦‚éœ€è¦ï¼‰
6. **Branch Specifier**: `*/main` æˆ– `*/master`
7. **Script Path**: `Jenkinsfile`ï¼ˆé»˜è®¤ï¼‰

### 3. å‡†å¤‡é¡¹ç›®æ–‡ä»¶

å°†ä»¥ä¸‹æ–‡ä»¶å¤åˆ¶åˆ°ä½ çš„é¡¹ç›®æ ¹ç›®å½•ï¼š

```bash
# å¤åˆ¶æµ‹è¯•è„šæœ¬
cp jenkins-test.js /path/to/your/project/
cp Jenkinsfile /path/to/your/project/

# å¦‚æœéœ€è¦ï¼Œåˆ›å»ºpackage.json
echo '{
  "name": "weapp-button-test",
  "version": "1.0.0",
  "scripts": {
    "test": "node jenkins-test.js"
  }
}' > /path/to/your/project/package.json
```

### 4. è¿è¡Œæµ‹è¯•

#### æ‰‹åŠ¨è§¦å‘æ„å»º
1. è¿›å…¥Jenkinsé¡¹ç›®é¡µé¢
2. ç‚¹å‡» `ç«‹å³æ„å»º`
3. æŸ¥çœ‹æ„å»ºæ—¥å¿—å’Œç»“æœ

#### æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
æ„å»ºå®Œæˆåï¼Œå¯ä»¥æŸ¥çœ‹ï¼š
- **æ„å»ºå†å²**: ç‚¹å‡»æ„å»ºå·æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
- **æµ‹è¯•æŠ¥å‘Š**: åœ¨æ„å»ºé¡µé¢å·¦ä¾§èœå•ç‚¹å‡» `æŒ‰é’®åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š`
- **JUnitç»“æœ**: æŸ¥çœ‹æµ‹è¯•ç”¨ä¾‹çš„è¯¦ç»†ä¿¡æ¯

## ğŸ”§ é«˜çº§é…ç½®

### 1. è‡ªå®šä¹‰æµ‹è¯•ç”¨ä¾‹

ç¼–è¾‘ `jenkins-test.js` ä¸­çš„ `TEST_CASES` æ•°ç»„ï¼š

```javascript
const TEST_CASES = [
  {
    page: 'pages/your-page/your-page',
    cases: [
      {
        name: 'ä½ çš„æŒ‰é’®åç§°',
        action: 'yourFunctionName',
        expected: { type: 'function', shouldExist: true },
        description: 'æµ‹è¯•æè¿°'
      }
    ]
  }
];
```

### 2. ç¯å¢ƒå˜é‡é…ç½®

åœ¨Jenkinsé¡¹ç›®é…ç½®ä¸­å¯ä»¥è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `TEST_REPORT_DIR` | `test-results` | æµ‹è¯•æŠ¥å‘Šç›®å½• |
| `JUNIT_REPORT_PATH` | `test-results/junit.xml` | JUnitæŠ¥å‘Šè·¯å¾„ |
| `HTML_REPORT_PATH` | `test-results/report.html` | HTMLæŠ¥å‘Šè·¯å¾„ |
| `JSON_REPORT_PATH` | `test-results/results.json` | JSONæŠ¥å‘Šè·¯å¾„ |

### 3. å®šæ—¶æ„å»º

åœ¨Jenkinsfileä¸­æ·»åŠ å®šæ—¶è§¦å‘ï¼š

```groovy
triggers {
    // æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
    cron('H 2 * * *')
    
    // æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼ˆå·¥ä½œæ—¥ï¼‰
    // cron('H * * * 1-5')
}
```

### 4. é€šçŸ¥é…ç½®

#### é‚®ä»¶é€šçŸ¥
åœ¨Jenkinsfileçš„ `post` éƒ¨åˆ†æ·»åŠ ï¼š

```groovy
post {
    always {
        emailext (
            subject: "æ„å»ºé€šçŸ¥: ${env.JOB_NAME} - ${env.BUILD_NUMBER} - ${currentBuild.currentResult}",
            body: """æ„å»ºç»“æœ: ${currentBuild.currentResult}
é¡¹ç›®: ${env.JOB_NAME}
æ„å»ºå·: ${env.BUILD_NUMBER}
æŸ¥çœ‹è¯¦æƒ…: ${env.BUILD_URL}""",
            to: "your-email@example.com"
        )
    }
}
```

#### é’‰é’‰é€šçŸ¥
å®‰è£… `DingTalk` æ’ä»¶åï¼š

```groovy
post {
    always {
        dingtalk (
            robot: 'your-dingtalk-robot',
            type: 'MARKDOWN',
            title: 'æ„å»ºé€šçŸ¥',
            text: """
## æ„å»ºé€šçŸ¥
- **é¡¹ç›®**: ${env.JOB_NAME}
- **æ„å»ºå·**: ${env.BUILD_NUMBER}
- **çŠ¶æ€**: ${currentBuild.currentResult}
- **æŸ¥çœ‹**: [æ„å»ºè¯¦æƒ…](${env.BUILD_URL})
"""
        )
    }
}
```

## ğŸ“Š æŠ¥å‘Šè§£è¯»

### 1. JUnitæŠ¥å‘Š
- **æ ¼å¼**: æ ‡å‡†JUnit XMLæ ¼å¼
- **ç”¨é€”**: Jenkinsè‡ªåŠ¨è§£æï¼Œæ˜¾ç¤ºæµ‹è¯•è¶‹åŠ¿
- **ä½ç½®**: `test-results/junit.xml`

### 2. HTMLæŠ¥å‘Š
- **æ ¼å¼**: ç¾è§‚çš„HTMLé¡µé¢
- **å†…å®¹**: è¯¦ç»†æµ‹è¯•ç»“æœã€é”™è¯¯ä¿¡æ¯ã€ç¯å¢ƒä¿¡æ¯
- **ä½ç½®**: `test-results/report.html`
- **è®¿é—®**: Jenkinsé¡¹ç›®é¡µé¢ â†’ æŒ‰é’®åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š

### 3. JSONæŠ¥å‘Š
- **æ ¼å¼**: ç»“æ„åŒ–JSONæ•°æ®
- **ç”¨é€”**: ä¾›å…¶ä»–ç³»ç»Ÿé›†æˆä½¿ç”¨
- **ä½ç½®**: `test-results/results.json`

### æŠ¥å‘Šç¤ºä¾‹

```json
{
  "metadata": {
    "generatedAt": "2025-12-08T10:30:00.000Z",
    "environment": {
      "nodeVersion": "v16.20.0",
      "platform": "linux",
      "jenkins": true
    }
  },
  "summary": {
    "total": 25,
    "passed": 23,
    "failed": 2,
    "errors": 0
  }
}
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. "Node.jså‘½ä»¤æœªæ‰¾åˆ°"
**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿å®‰è£…äº†Node.jsæ’ä»¶
- æ£€æŸ¥å…¨å±€å·¥å…·é…ç½®ä¸­çš„Node.jsè®¾ç½®
- åœ¨Jenkinsfileä¸­ç¡®ä¿æ­£ç¡®è®¾ç½®äº†PATHç¯å¢ƒå˜é‡

#### 2. "æµ‹è¯•è„šæœ¬æ‰§è¡Œå¤±è´¥"
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥jenkins-test.jsæ–‡ä»¶æ˜¯å¦å­˜åœ¨
- ç¡®è®¤æ–‡ä»¶æƒé™æ­£ç¡®
- æŸ¥çœ‹æ„å»ºæ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

#### 3. "HTMLæŠ¥å‘Šæ— æ³•æ˜¾ç¤º"
**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿å®‰è£…äº†HTML Publisher Plugin
- æ£€æŸ¥CSPï¼ˆå†…å®¹å®‰å…¨ç­–ç•¥ï¼‰è®¾ç½®
- ç¡®è®¤æŠ¥å‘Šæ–‡ä»¶è·¯å¾„æ­£ç¡®

#### 4. "JUnitæŠ¥å‘Šè§£æå¤±è´¥"
**è§£å†³æ–¹æ¡ˆ**:
- ç¡®è®¤XMLæ–‡ä»¶æ ¼å¼æ­£ç¡®
- æ£€æŸ¥æ–‡ä»¶ç¼–ç æ˜¯å¦ä¸ºUTF-8
- éªŒè¯æ–‡ä»¶è·¯å¾„å’Œæƒé™

### è°ƒè¯•æŠ€å·§

#### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
ä¿®æ”¹jenkins-test.jsè°ƒç”¨ï¼š
```bash
node jenkins-test.js --verbose
```

#### 2. æœ¬åœ°æµ‹è¯•
åœ¨Jenkinsç¯å¢ƒä¸­å…ˆè¿è¡Œï¼š
```bash
# è¿›å…¥å·¥ä½œç©ºé—´ç›®å½•
cd $WORKSPACE

# æ‰‹åŠ¨æ‰§è¡Œæµ‹è¯•
node jenkins-test.js

# æ£€æŸ¥ç”Ÿæˆçš„æŠ¥å‘Š
ls -la test-results/
```

#### 3. ç¯å¢ƒå˜é‡è°ƒè¯•
åœ¨Jenkinsfileä¸­æ·»åŠ è°ƒè¯•è¾“å‡ºï¼š
```groovy
stage('è°ƒè¯•ä¿¡æ¯') {
    steps {
        echo "å·¥ä½œç©ºé—´: ${WORKSPACE}"
        echo "Node.jsè·¯å¾„: ${NODE_HOME}"
        sh 'echo $PATH'
        sh 'which node'
        sh 'node --version'
    }
}
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç‰ˆæœ¬æ§åˆ¶
- å°†æ‰€æœ‰Jenkinsç›¸å…³æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶
- ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ç®¡ç†
- ä¸ºä¸åŒçš„ç¯å¢ƒåˆ›å»ºä¸åŒçš„åˆ†æ”¯

### 2. æµ‹è¯•ç­–ç•¥
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- å®ç°æµ‹è¯•ç”¨ä¾‹çš„ç‹¬ç«‹æ€§
- å®šæœŸæ›´æ–°æµ‹è¯•ç”¨ä¾‹

### 3. æ€§èƒ½ä¼˜åŒ–
- å¹¶è¡Œæ‰§è¡Œæµ‹è¯•ï¼ˆå¦‚æœå¯èƒ½ï¼‰
- ç¼“å­˜ä¾èµ–åŒ…
- æ¸…ç†ä¸´æ—¶æ–‡ä»¶

### 4. ç›‘æ§å‘Šè­¦
- è®¾ç½®æ„å»ºå¤±è´¥é€šçŸ¥
- ç›‘æ§æµ‹è¯•é€šè¿‡ç‡è¶‹åŠ¿
- å»ºç«‹æµ‹è¯•å¤±è´¥çš„å“åº”æµç¨‹

## ğŸ“ˆ æ‰©å±•åŠŸèƒ½

### 1. é›†æˆSonarQube
```groovy
stage('ä»£ç è´¨é‡åˆ†æ') {
    steps {
        withSonarQubeEnv('SonarQube') {
            sh 'sonar-scanner'
        }
    }
}
```

### 2. éƒ¨ç½²é›†æˆ
```groovy
stage('éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ') {
    steps {
        sh 'npm run deploy:test'
    }
}
```

### 3. æ€§èƒ½æµ‹è¯•
```groovy
stage('æ€§èƒ½æµ‹è¯•') {
    steps {
        sh 'npm run test:performance'
    }
}
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨å®æ–½è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. **æŸ¥çœ‹Jenkinsæ—¥å¿—**: Jenkinsç®¡ç† â†’ ç³»ç»Ÿæ—¥å¿—
2. **æ£€æŸ¥æ„å»ºå†å²**: é¡¹ç›®é¡µé¢ â†’ æ„å»ºå†å²
3. **æŸ¥é˜…æ’ä»¶æ–‡æ¡£**: Jenkinsæ’ä»¶ç®¡ç†å™¨ä¸­çš„æ–‡æ¡£é“¾æ¥
4. **ç¤¾åŒºæ”¯æŒ**: Jenkinså®˜æ–¹è®ºå›å’ŒGitHub Issues

---

**æ³¨æ„**: æœ¬æ•™ç¨‹åŸºäºJenkins 2.xç‰ˆæœ¬ï¼Œä¸åŒç‰ˆæœ¬å¯èƒ½å­˜åœ¨é…ç½®å·®å¼‚ã€‚å»ºè®®åœ¨å®é™…ä½¿ç”¨å‰å…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯é…ç½®ã€‚